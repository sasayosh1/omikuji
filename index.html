<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#b91c1c" />
  <title>åˆå¹´ãŠã¿ãã˜ 2026</title>
  <style>
    :root{
      --bg:#fff7ed;
      --ink:#0f172a;
      --muted:#475569;
      --card:#ffffffcc;
      --line:#e2e8f0;
      --red:#b91c1c;
      --gold:#a16207;
      --shadow: 0 20px 60px rgba(2,6,23,.12);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, #fff 0%, var(--bg) 60%, #fff 100%);
      overflow-x:hidden;
    }

    /* å’ŒæŸ„èƒŒæ™¯ï¼ˆè»½é‡ï¼‰ */
    .pattern{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(circle at 25px 25px, rgba(185,28,28,.10) 2px, transparent 3px) 0 0/50px 50px,
        radial-gradient(circle at 25px 25px, rgba(161,98,7,.10) 2px, transparent 3px) 25px 25px/50px 50px;
      opacity:.9;
    }
    .glow{
      position:fixed; inset:-40% -20%; z-index:-3;
      background: radial-gradient(circle at 30% 30%, rgba(185,28,28,.14), transparent 50%),
                  radial-gradient(circle at 70% 60%, rgba(161,98,7,.12), transparent 55%);
      filter: blur(10px);
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px 14px 26px;
    }
    .app{
      width:min(520px, 100%);
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
      padding:0 6px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--line);
      box-shadow: 0 8px 24px rgba(2,6,23,.06);
      font-weight:700;
      letter-spacing:.02em;
    }
    .badge small{font-weight:700;color:var(--muted)}
    .toggles{
      display:flex; gap:10px; align-items:center;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--line);
      cursor:pointer;
      user-select:none;
      box-shadow: 0 8px 24px rgba(2,6,23,.06);
      font-weight:700;
      color:var(--ink);
    }
    .chip input{display:none}
    .dot{
      width:12px;height:12px;border-radius:999px;
      background: #cbd5e1;
      position:relative;
    }
    .chip input:checked + .dot{ background: var(--red); }
    .chip input:checked + .dot::after{
      content:""; position:absolute; inset:2px;
      background:#fff; border-radius:999px;
    }

    .card{
      background:var(--card);
      border:1px solid rgba(226,232,240,.9);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .header{
      padding:18px 18px 14px;
      border-bottom:1px solid rgba(226,232,240,.7);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .title h1{
      margin:0;
      font-size:22px;
      letter-spacing:.03em;
    }
    .title p{
      margin:8px 0 0;
      color:var(--muted);
      font-weight:600;
      line-height:1.45;
    }
    .seal{
      width:62px;height:62px;
      border-radius:14px;
      border:2px solid rgba(185,28,28,.35);
      display:grid; place-items:center;
      transform: rotate(6deg);
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.45));
      position:relative;
    }
    .seal::before{
      content:"";
      position:absolute; inset:10px;
      border-radius:10px;
      border:2px dashed rgba(185,28,28,.35);
    }
    .seal span{
      font-weight:900;
      color:var(--red);
      letter-spacing:.08em;
    }

    .body{
      padding:18px;
    }

    .omikuji-box{
      display:grid;
      gap:14px;
    }

    /* å¼•ãæ¼”å‡ºï¼ˆç´™ãŒå‡ºã‚‹ï¼‰ */
    .draw-area{
      border:1px solid rgba(226,232,240,.9);
      border-radius:18px;
      background:rgba(255,255,255,.72);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .lantern{
      position:absolute; top:-22px; right:-18px;
      width:120px; height:120px;
      background: radial-gradient(circle at 35% 30%, rgba(185,28,28,.30), transparent 58%),
                  radial-gradient(circle at 65% 70%, rgba(161,98,7,.22), transparent 60%);
      filter: blur(0px);
      transform: rotate(15deg);
      pointer-events:none;
    }

    .result{
      display:grid;
      gap:10px;
      padding:10px 4px 0;
    }
    .fortune{
      font-size:44px;
      font-weight:1000;
      letter-spacing:.06em;
      line-height:1.0;
      margin:4px 0 2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-weight:750;
      line-height:1.5;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }
    .panel{
      border:1px solid rgba(226,232,240,.9);
      background:rgba(255,255,255,.75);
      border-radius:16px;
      padding:12px;
    }
    .panel h3{
      margin:0 0 8px;
      font-size:13px;
      color:var(--muted);
      letter-spacing:.06em;
    }
    .panel p{
      margin:0;
      font-weight:800;
      line-height:1.4;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      appearance:none; border:none; cursor:pointer;
      padding:14px 16px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:.04em;
      box-shadow: 0 16px 40px rgba(185,28,28,.20);
      transition: transform .08s ease, filter .2s ease;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn-primary{
      background: linear-gradient(180deg, #dc2626, #991b1b);
      color:#fff;
    }
    .btn-ghost{
      background:rgba(255,255,255,.85);
      border:1px solid rgba(226,232,240,.95);
      color:var(--ink);
      box-shadow: 0 12px 30px rgba(2,6,23,.08);
    }

    .footer{
      padding:14px 18px 18px;
      border-top:1px solid rgba(226,232,240,.7);
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
    }

    /* ç´™å¹é›ª */
    .confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:9999;
      overflow:hidden;
    }
    .confetti i{
      position:absolute;
      top:-10vh;
      width:10px;height:14px;
      opacity:.95;
      transform: rotate(10deg);
      animation: fall 1200ms linear forwards;
      border-radius:3px;
    }
    @keyframes fall{
      to{ transform: translateY(120vh) rotate(520deg); opacity:1; }
    }

    /* ãŠã¿ãã˜ç´™ï¼ˆå‡ºã‚‹ï¼‰ */
    .paper{
      position:absolute;
      left:50%;
      top:54px;
      width:min(320px, 86%);
      transform: translateX(-50%);
      border-radius:16px;
      border:1px solid rgba(226,232,240,.9);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.82));
      box-shadow: 0 22px 60px rgba(2,6,23,.14);
      padding:14px 14px 12px;
      opacity:0;
      translate: 0 -14px;
      pointer-events:none;
    }
    .paper.show{
      opacity:1;
      translate: 0 0;
      transition: opacity .25s ease, translate .25s ease;
    }
    .paper .mini{
      display:flex; justify-content:space-between; align-items:center;
      color:var(--muted);
      font-weight:800;
      font-size:12px;
      letter-spacing:.06em;
    }
    .paper .stamp{
      font-weight:1000;
      color:var(--red);
    }

    @media (max-width:420px){
      .fortune{font-size:40px}
      .grid{grid-template-columns:1fr}
      .seal{display:none}
      .topbar{flex-direction:column; align-items:stretch}
      .toggles{justify-content:space-between}
    }
  </style>
</head>
<body>
  <div class="glow"></div>
  <div class="pattern"></div>
  <div class="confetti" id="confetti"></div>

  <main class="wrap">
    <section class="app">
      <div class="topbar">
        <div class="badge">ğŸ´ åˆå¹´ãŠã¿ãã˜ <small>2026</small></div>
        <div class="toggles">
          <label class="chip" title="éŸ³">
            <input id="soundToggle" type="checkbox" checked />
            <span class="dot"></span>
            <span>éŸ³</span>
          </label>
          <label class="chip" title="æ¼”å‡º">
            <input id="effectToggle" type="checkbox" checked />
            <span class="dot"></span>
            <span>æ¼”å‡º</span>
          </label>
        </div>
      </div>

      <div class="card">
        <div class="header">
          <div class="title">
            <h1>ã‚ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†ï¼</h1>
            <p>â€œå‰å‘ãâ€ã ã‘ã‚’è©°ã‚ãŸãŠã¿ãã˜ã€‚<br>åˆå¹´ã¯ã€Œä¸€æ­©é€²ã‚€äººã€ãŒå¼·ã„å¹´ã€‚</p>
          </div>
          <div class="seal" aria-hidden="true"><span>æœ±</span></div>
        </div>

        <div class="body">
          <div class="omikuji-box">
            <div class="draw-area">
              <div class="lantern" aria-hidden="true"></div>
              <div class="paper" id="paper" aria-hidden="true">
                <div class="mini">
                  <span id="today"></span>
                  <span class="stamp">é–‹é‹</span>
                </div>
                <div style="height:8px"></div>
                <div style="font-weight:1000;font-size:16px;letter-spacing:.06em" id="paperTitle">ãŠã¿ãã˜</div>
                <div style="margin-top:6px;color:var(--muted);font-weight:800;line-height:1.45" id="paperMsg">
                  ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãŠã¿ãã˜ç´™ãŒå‡ºã¦ãã¾ã™ã€‚
                </div>
              </div>

              <div class="result" aria-live="polite">
                <div class="fortune" id="fortune">â€”</div>
                <p class="subtitle" id="lead">ã€ŒãŠã¿ãã˜ã‚’å¼•ãã€ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼</p>

                <div class="grid">
                  <div class="panel">
                    <h3>ä»•äº‹ãƒ»å­¦ã³</h3>
                    <p id="work">â€”</p>
                  </div>
                  <div class="panel">
                    <h3>æ‹æ„›ãƒ»äººé–“é–¢ä¿‚</h3>
                    <p id="love">â€”</p>
                  </div>
                  <div class="panel">
                    <h3>é‡‘é‹</h3>
                    <p id="money">â€”</p>
                  </div>
                  <div class="panel">
                    <h3>å¥åº·</h3>
                    <p id="health">â€”</p>
                  </div>
                </div>

                <div class="grid">
                  <div class="panel">
                    <h3>ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ </h3>
                    <p id="item">â€”</p>
                  </div>
                  <div class="panel">
                    <h3>ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼</h3>
                    <p id="color">â€”</p>
                  </div>
                </div>

                <div class="actions">
                  <button class="btn btn-primary" id="drawBtn">ğŸ´ ãŠã¿ãã˜ã‚’å¼•ã</button>
                  <button class="btn btn-ghost" id="shareBtn">ğŸ“© LINEã§ã‚·ã‚§ã‚¢</button>
                  <button class="btn btn-ghost" id="copyBtn">ğŸ”— çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="footer">
          â€»ã€Œå‡¶ãƒ»å¤§å‡¶ã€ã¯å…¥ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
          å‹ã ã¡ã«è²¼ã‚‹ç”¨é€”ãªã®ã§ã€å‰å‘ãã«çµ‚ã‚ã‚‹è¨­è¨ˆã§ã™ã€‚
        </div>
      </div>
    </section>
  </main>

  <script>
    // ---- ãƒ‡ãƒ¼ã‚¿ï¼ˆå‡¶ãƒ»å¤§å‡¶ãªã—ï¼å‰å‘ãï¼‰ ----
    const fortunes = [
      { name:"å¤§å‰", w:18, lead:"ä¸»å½¹ã¯ã‚ãªãŸã€‚è¿·ã£ãŸã‚‰å‰é€²ã§æ­£è§£ã€‚", tone:"å‹¢ã„ãŒã‚ã‚‹æ—¥ã€‚å°ã•ãã¦ã‚‚â€œä¸€æ­©â€ãŒé‹ã‚’é–‹ãã¾ã™ã€‚" },
      { name:"ä¸­å‰", w:24, lead:"æµã‚Œã¯ä¸Šå‘ãã€‚ä¸å¯§ã•ãŒå‘³æ–¹ã€‚", tone:"ç©ã¿é‡ã­ãŒåŠ¹ãæ—¥ã€‚ã‚„ã‚‹ã“ã¨ã‚’1ã¤ã«çµã‚‹ã¨å¼·ã„ã§ã™ã€‚" },
      { name:"å°å‰", w:22, lead:"è‚©ã®åŠ›ã‚’æŠœãã»ã©ã€ã†ã¾ãã„ãã€‚", tone:"æ•´ãˆã‚‹æ—¥ã€‚ç‰‡ã¥ã‘ãƒ»æº–å‚™ãŒãã®ã¾ã¾é‹ã«ãªã‚Šã¾ã™ã€‚" },
      { name:"å‰",   w:20, lead:"è‰¯ã„èŠ½ãŒå‡ºã‚‹ã€‚ç¶šã‘ãŸäººãŒå‹ã¤ã€‚", tone:"ç¶šã‘ã‚‹ã»ã©å¼·ããªã‚‹æ—¥ã€‚3æ—¥ã ã‘ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚" },
      { name:"æœ«å‰", w:16, lead:"ã‚†ã£ãã‚Šå¼·ãã€‚å¾ŒåŠã«ä¼¸ã³ã‚‹é‹ã€‚", tone:"ä»Šã¯ä»•è¾¼ã¿ã€‚ç„¦ã‚‰ãšã€åœŸå°ã¥ãã‚ŠãŒå¤§å½“ãŸã‚Šã§ã™ã€‚" },
    ];

    const work = [
      "æœã„ã¡ã«â€œ1åˆ†â€ã ã‘ç€æ‰‹ã™ã‚‹ã¨åŠ é€Ÿã™ã‚‹",
      "ä»Šæ—¥ã®å‹ã¡ç­‹ã¯ã€ã‚„ã‚‹ã“ã¨ã‚’æ¸›ã‚‰ã™ã€",
      "é€£çµ¡ã¯çŸ­ãã€‚çµè«–â†’ç†ç”±ã§é€šã‚‹",
      "å­¦ã³ã¯â€œå¾©ç¿’â€ãŒæœ€å¼·ã€‚è¦‹è¿”ã™ã ã‘ã§ä¼¸ã³ã‚‹",
      "æ–°ã—ã„é“å…·ã‚ˆã‚Šã€ä»Šã®å‹ã‚’ç£¨ãã¨çµæœãŒå‡ºã‚‹",
      "åˆå¹´ã¯ã‚¹ãƒ”ãƒ¼ãƒ‰å¹´ã€‚å°ã•ãè©¦ã™ã»ã©å½“ãŸã‚‹"
    ];
    const love = [
      "æ°—ã¥ã‹ã„ã¯â€œè¨€è‘‰â€ã«ã™ã‚‹ã¨ä¼ã‚ã‚‹",
      "èª˜ã†ãªã‚‰è»½ãã€‚ã€5åˆ†ã ã‘è©±ãã€ãŒæ­£è§£",
      "ç›¸æ‰‹ã®è‰¯ã„ã¨ã“ã‚ã‚’1ã¤è¨€ã†ã¨ç©ºæ°—ãŒå¤‰ã‚ã‚‹",
      "å¤§äº‹ãªã®ã¯æ­£ã—ã•ã‚ˆã‚Šã€ã‚ãŸãŸã‹ã•",
      "é€£çµ¡ã¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°é‡è¦–ã€‚å¤œã‚ˆã‚Šæ˜¼ãŒå‰",
      "çŸ­ã„æ„Ÿè¬ãŒã€ä¸€ç•ªåŠ¹ã"
    ];
    const money = [
      "è²·ã†å‰ã«1å›ã ã‘ã‚«ãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹ã¨å®ˆã‚Œã‚‹",
      "å›ºå®šè²»ã®è¦‹ç›´ã—ãŒâ€œãŠå¹´ç‰â€ã«ãªã‚‹",
      "å°ã•ãªç¯€ç´„ã‚ˆã‚Šã€ãƒ ãƒ€ã®1å€‹å‰Šæ¸›ãŒåŠ¹ã",
      "æ”¯å‡ºã¯â€œè¨˜éŒ²â€ã™ã‚‹ã¨è‡ªç„¶ã«æ•´ã†",
      "æŠ•è³‡ã¯ç„¦ã‚‰ãšã€‚ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã£ãŸäººãŒå‹ã¤",
      "è‡¨æ™‚åå…¥ã‚ˆã‚Šâ€œå®ˆã‚Šâ€ãŒé‹ã‚’å‘¼ã¶"
    ];
    const health = [
      "å§¿å‹¢ã‚’æˆ»ã™ã ã‘ã§é›†ä¸­åŠ›ãŒä¸ŠãŒã‚‹",
      "æ°´ã‚’ä¸€å£ã€‚ä½“ãŒç›®è¦šã‚ã‚‹",
      "5åˆ†æ•£æ­©ãŒä¸€ç•ªã‚³ã‚¹ãƒ‘é«˜ã„å›å¾©",
      "ç›®ã¨è‚©ã‚’ä¼‘ã¾ã›ã‚‹ã¨é‹æ°—ã‚‚æˆ»ã‚‹",
      "ç¡çœ ã®è³ªãŒæœ€å„ªå…ˆã€‚ä»Šæ—¥ã¯æ—©ã‚ã«çµ‚ã‚ã‚‹",
      "æ¸©ã‹ã„é£²ã¿ç‰©ã§æ•´ã†"
    ];
    const items = ["çµµé¦¬","ã¿ã‹ã‚“","é¡é¤…","ãŠå®ˆã‚Šè¢‹","æ–°ã—ã„ãƒãƒ¼ãƒˆ","èµ¤ã„ãƒšãƒ³","ç™½ã„ãƒãƒ³ã‚«ãƒ","å°ã•ãªå·¾ç€","å¹²æ”¯ã®ç½®ç‰©","ç®¸ç½®ã"];
    const colors = ["æœ±ï¼ˆã‚ã‹ï¼‰","é‡‘","ç™½","è—","è‹¥è‰è‰²","è–„ç´…","ç´º","ç”Ÿæˆã‚Š","ã“ã’èŒ¶","æ°´è‰²"];

    // ---- ä¾¿åˆ©é–¢æ•° ----
    const $ = (id) => document.getElementById(id);
    const rnd = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const weightedPick = (arr) => {
      const total = arr.reduce((s,a)=>s+a.w,0);
      let r = Math.random() * total;
      for(const a of arr){ r -= a.w; if(r <= 0) return a; }
      return arr[arr.length-1];
    };

    const state = {
      current: null,
      sound: true,
      effects: true,
    };

    // ---- éŸ³ï¼ˆWebAudioï¼šç„¡æ–™ï¼‰ ----
    let audioCtx;
    const beep = (type="draw") => {
      if(!state.sound) return;
      try{
        audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);

        if(type==="draw"){
          o.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
          g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
          g.gain.exponentialRampToValueAtTime(0.12, audioCtx.currentTime+0.02);
          g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.18);
          o.start(); o.stop(audioCtx.currentTime+0.20);
        }else{
          o.frequency.setValueAtTime(659.25, audioCtx.currentTime); // E5
          g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
          g.gain.exponentialRampToValueAtTime(0.10, audioCtx.currentTime+0.02);
          g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.14);
          o.start(); o.stop(audioCtx.currentTime+0.16);
        }
      }catch(e){}
    };

    // ---- ç´™å¹é›ª ----
    const confetti = () => {
      if(!state.effects) return;
      const root = $("confetti");
      root.innerHTML = "";
      const colors = ["#dc2626","#b91c1c","#a16207","#f59e0b","#ffffff","#0f172a"];
      const n = 26;
      for(let i=0;i<n;i++){
        const el = document.createElement("i");
        const left = Math.random()*100;
        const delay = Math.random()*140;
        const dur = 900 + Math.random()*700;
        el.style.left = left + "vw";
        el.style.animationDelay = delay + "ms";
        el.style.animationDuration = dur + "ms";
        el.style.background = colors[Math.floor(Math.random()*colors.length)];
        el.style.transform = `rotate(${Math.random()*120}deg)`;
        el.style.width = (8 + Math.random()*8) + "px";
        el.style.height = (10 + Math.random()*10) + "px";
        root.appendChild(el);
      }
      setTimeout(()=>{ root.innerHTML=""; }, 1700);
    };

    // ---- çµæœç”Ÿæˆ ----
    const generate = () => {
      const f = weightedPick(fortunes);
      const result = {
        fortune: f.name,
        lead: f.lead,
        tone: f.tone,
        work: rnd(work),
        love: rnd(love),
        money: rnd(money),
        health: rnd(health),
        item: rnd(items),
        color: rnd(colors),
        stamp: "é–‹é‹",
        date: new Date().toLocaleString("ja-JP", { year:"numeric", month:"2-digit", day:"2-digit" }),
      };
      return result;
    };

    const render = (r) => {
      $("fortune").textContent = r.fortune;
      $("lead").textContent = r.tone;

      $("work").textContent = r.work;
      $("love").textContent = r.love;
      $("money").textContent = r.money;
      $("health").textContent = r.health;
      $("item").textContent = r.item;
      $("color").textContent = r.color;

      $("today").textContent = r.date;
      $("paperTitle").textContent = `ã€${r.fortune}ã€‘`;
      $("paperMsg").textContent = r.lead;

      const paper = $("paper");
      paper.classList.add("show");
      if(state.effects){
        setTimeout(()=>paper.classList.remove("show"), 980);
      }
    };

    const makeShareText = (r) => {
      const url = location.href;
      return `ğŸ´ åˆå¹´ãŠã¿ãã˜2026\nã€${r.fortune}ã€‘${r.lead}\nä»•äº‹: ${r.work}\næ‹æ„›: ${r.love}\né‡‘é‹: ${r.money}\nå¥åº·: ${r.health}\nãƒ©ãƒƒã‚­ãƒ¼: ${r.item} / ${r.color}\n${url}`;
    };

    const share = async () => {
      if(!state.current) return;
      const text = makeShareText(state.current);
      beep("tap");

      // Web Share APIï¼ˆã‚¹ãƒãƒ›ã§LINEå…±æœ‰ãŒå‡ºã‚„ã™ã„ï¼‰
      if(navigator.share){
        try{
          await navigator.share({ title:"åˆå¹´ãŠã¿ãã˜2026", text, url: location.href });
          return;
        }catch(e){ /* ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãªã© */ }
      }
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šã‚³ãƒ”ãƒ¼
      await copyText(text);
      alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼LINEã«è²¼ã‚Šä»˜ã‘ã¦é€ã£ã¦ã­ğŸ´");
    };

    const copyText = async (text) => {
      try{
        await navigator.clipboard.writeText(text);
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
    };

    // ---- ã‚¤ãƒ™ãƒ³ãƒˆ ----
    $("drawBtn").addEventListener("click", () => {
      state.current = generate();
      beep("draw");
      render(state.current);
      confetti();
      // URLã«ã‚¯ã‚¨ãƒªã§å…±æœ‰ã‚‚å¯ï¼ˆé‡ãã—ãªã„ãŸã‚â€œçµæœå›ºå®šâ€ã¯çœç•¥ï¼‰
    });

    $("shareBtn").addEventListener("click", share);

    $("copyBtn").addEventListener("click", async () => {
      if(!state.current){
        alert("å…ˆã«ãŠã¿ãã˜ã‚’å¼•ã„ã¦ã­ï¼");
        return;
      }
      beep("tap");
      await copyText(makeShareText(state.current));
      alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    });

    $("soundToggle").addEventListener("change", (e)=> state.sound = e.target.checked );
    $("effectToggle").addEventListener("change", (e)=> state.effects = e.target.checked );

    // åˆæœŸè¡¨ç¤ºï¼šæ—¥ä»˜ã ã‘ã‚»ãƒƒãƒˆ
    $("today").textContent = new Date().toLocaleString("ja-JP", { year:"numeric", month:"2-digit", day:"2-digit" });
  </script>
</body>
</html>
